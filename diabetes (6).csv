import pandas as pd
import numpy as np
from sklearn.ensemble import RandomForestRegressor
from sklearn.model_selection import train_test_split, RandomizedSearchCV
from sklearn.impute import SimpleImputer
from sklearn.preprocessing import StandardScaler, OrdinalEncoder, OneHotEncoder
from sklearn.pipeline import Pipeline
from sklearn.compose import ColumnTransformer
from sklearn.svm import SVR
from sklearn.model_selection import GridSearchCV
from lazypredict.Supervised import LazyRegressor

from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score


data = pd.read_csv("StudentsPerformance (3)(ML).csv")

target = "math score"
X = data.drop(target, axis=1)
y = data[target]

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)


num_transformer = Pipeline(steps=[
    ('imputer', SimpleImputer(strategy='median')),
    ('scaler', StandardScaler())
])


ord_transformer = Pipeline(steps=[
    ('imputer', SimpleImputer(strategy='most_frequent')),
    ('encoder', OrdinalEncoder(
        handle_unknown="use_encoded_value",
        unknown_value=-1
    ))
])


nominal_transformer = Pipeline(steps=[
    ('imputer', SimpleImputer(strategy='most_frequent')),
    ('encoder', OneHotEncoder(
        sparse_output=False,
        handle_unknown="ignore"
    ))
])


preprocessor = ColumnTransformer(transformers=[
    ('num', num_transformer, ["reading score", "writing score"]),
    ('ord', ord_transformer, [
        "parental level of education",
        "gender",
        "lunch",
        "test preparation course"
    ]),
    ('nominal', nominal_transformer, ["race/ethnicity"])
])


X_train = preprocessor.fit_transform(X_train)
X_test = preprocessor.transform(X_test)

lazy_reg=LazyRegressor(verbose=0,ignore_warnings=False,custom_metric=None)
model,predictions = lazy_reg.fit(X_train,X_test,y_train,y_test)
print(model)
#parameters = {
#    "regressor__n_estimators": [50, 100, 200],
#    "regressor__criterion": ["squared_error", "absolute_error",],
#    "regressor__max_depth":[5,10,15],
#    "preprocessor__num__imputer__strategy": ["median", "most_frequent"]
#}


#reg = Pipeline([
 #   ("preprocessor", preprocessor),
 #   ("regressor", RandomForestRegressor(random_state=42))
#])

#model=GridSearchCV(reg,param_grid=parameters,scoring="r2",cv=6,verbose=1,)
#model=RandomizedSearchCV(reg,param_distributions=parameter,scoring="r2",n_iter=20,n_jobs=8)
#model.fit(X_train,y_train)
#print(model.best_score_)
#print(model.best_params_)


#y_pred = model.predict(X_test)

#print("MAE:", mean_absolute_error(y_test, y_pred))
#print("MSE:", mean_squared_error(y_test, y_pred))
#print("R2:", r2_score(y_test, y_pred))








